#!/bin/bash

# File containing the input data
INPUT_FILE="para.txt"

# Oracle credentials
DB_CREDENTIALS="your_username/your_password@your_db"

# Read and process each line in the input file
while IFS= read -r line; do
  # Parse the input line into variables
  table_name=$(echo "$line" | awk '{print $1}')
  db_name=$(echo "$line" | awk '{print $2}')
  actl_tbl_name=$(echo "$line" | awk '{print $3}')
  condition=$(echo "$line" | awk '{print $4, $5, $6, $7, $8, $9}')

  # Check for valid inputs
  if [[ -z "$table_name" || -z "$db_name" || -z "$actl_tbl_name" || -z "$condition" ]]; then
    echo "Skipping invalid line: $line"
    continue
  fi

  # Construct the SQL query
  sql_query="SELECT COUNT(*) FROM $db_name.$actl_tbl_name WHERE $condition;"

  # Log the query being executed
  echo "Executing query for table $table_name in database $db_name: $sql_query"

  # Execute the query using SQL*Plus and capture the result
  row_count=$(sqlplus -s "$DB_CREDENTIALS" <<EOF
SET FEEDBACK OFF
SET HEADING OFF
SET PAGESIZE 0
$sql_query
EXIT;
EOF
)

  # Output the result
  echo "Row count for $table_name: $row_count"

done < "$INPUT_FILE"
