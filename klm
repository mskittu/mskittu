WITH acct_cycle AS (
    SELECT
        acct_cyc.extnl_acct_id,
        acct_cyc.annl_fee_dscr,
        ROW_NUMBER() OVER (
            PARTITION BY acct_cyc.extnl_acct_id
            ORDER BY acct_cyc.eff_dt DESC
        ) AS rn_cycle_c
    FROM FMT_ACCT_DBA.EOM_ACCT_B acct_cyc
    WHERE acct_cyc.partition_date = '20251101'
)
SELECT
    asp.extnl_acct_id,
    ac.annl_fee_dscr
FROM DMT_ASP_DBA.ASP_EOM_ACCT_SUM asp
JOIN acct_cycle ac
    ON asp.extnl_acct_id = ac.extnl_acct_id
   AND ac.rn_cycle_c = 1
WHERE asp.partition_date = '20251101'
  AND asp.pltfm_cd = 'C';
