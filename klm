-- Step 1: Extract 1000 IDs (EXTNL_ACCT_ID) from the primary PCDS table
WITH extracted_ids AS (
    SELECT DISTINCT EXTNL_ACCT_ID
    FROM dmt_asp_dba.asp_emo_acct_sum
    FETCH FIRST 1000 ROWS ONLY
)

-- Step 2: Query attributes from all PCDS tables
SELECT 
    -- Attributes from PCDS table dmt_asp_dba.asp_emo_acct_sum
    p1.EXTNL_ACCT_ID AS EXTNL_ACCT_ID,
    p1.FCFEE_CHRGOFF_RVRSL_AMT AS FCFEE_CHRGOFF_RVRSL_AMT,
    p1.CCAR_CLOSE_STATRSN_FLAG AS CCAR_CLOSE_STATRSN_FLAG,
    p1.ANNL_FEE_CHRGOFF_RVRSL_AMT AS ANNL_FEE_CHRGOFF_RVRSL_AMT,
    p1.BAL_TXFR_GT_4_MOB_AMT AS BAL_TXFR_GT_4_MOB_AMT,
    p1.BAL_TXFR_LT_5_MOB_AMT AS BAL_TXFR_LT_5_MOB_AMT,
    p1.PURCH_FIN_CHRG_GROSS_AMT AS PURCH_FIN_CHRG_GROSS_AMT,
    p1.PAST_DUE_151_180_AMT AS PAST_DUE_151_180_AMT,
    p1.AVG_DLY_BAL_AMT AS AVG_DLY_BAL_AMT,
    p1.LATE_FEE_GROSS_CNT AS LATE_FEE_GROSS_CNT,
    p1.PAYMT_CNT AS PAYMT_CNT,
    p1.CASH_ADVNC_CNT AS CASH_ADVNC_CNT,
    p1.PROMO_BAL_TXFR_AMT AS PROMO_BAL_TXFR_AMT,
    p1.PROMO_CNVNCE_CHK_AMT AS PROMO_CNVNCE_CHK_AMT,
    p1.LOL_CNVNCE_CHK_AMT AS LOL_CNVNCE_CHK_AMT,
    p1.CNVNCE_CHK_AMT AS CNVNCE_CHK_AMT,
    p1.LOL_BAL_TXFR_AMT AS LOL_BAL_TXFR_AMT,
    p1.BAL_TXFR_AMT AS BAL_TXFR_AMT,
    p1.PAST_DUE_121_150_AMT AS PAST_DUE_121_150_AMT,
    p1.PAST_DUE_31_60_AMT AS PAST_DUE_31_60_AMT,
    p1.PAST_DUE_91_120_AMT AS PAST_DUE_91_120_AMT,
    p1.PAST_DUE_61_90_AMT AS PAST_DUE_61_90_AMT,
    p1.REWRD_PRTCP_FEE_CORVSL_AMT AS REWRD_PRTCP_FEE_CORVSL_AMT,
    p1.RPTG_PRD_MNTH_BID AS RPTG_PRD_MNTH_BID,
    p1.NOT_PAST_DUE_AMT AS NOT_PAST_DUE_AMT,
    p1.PAST_DUE_1_30_AMT AS PAST_DUE_1_30_AMT,
    p1.LOL_BT_FIN_CHRG_GROSS_AMT AS LOL_BT_FIN_CHRG_GROSS_AMT,
    p1.CASH_ADVNC_FIN_CHRG_GROSS_AMT AS CASH_ADVNC_FIN_CHRG_GROSS_AMT,
    p1.BAL_TXFR_FIN_CHRG_GROSS_AMT AS BAL_TXFR_FIN_CHRG_GROSS_AMT,
    p1.OVRLMT_FEE_NET_AMT AS OVRLMT_FEE_NET_AMT,
    p1.CASH_ADVNC_FEE_NET_AMT AS CASH_ADVNC_FEE_NET_AMT,
    p1.PROMO_BAL_TXFR_FEE_GROSS_AMT AS PROMO_BAL_TXFR_FEE_GROSS_AMT,
    p1.PURE_ACTIVE_FLAG AS PURE_ACTIVE_FLAG,
    p1.PROMO_BT_FIN_CHRG_GROSS_AMT AS PROMO_BT_FIN_CHRG_GROSS_AMT,
    p1.REVL_FLAG AS REVL_FLAG,
    p1.FEE_CHRGOFF_RVRSL_TOT_AMT AS FEE_CHRGOFF_RVRSL_TOT_AMT,
    p1.MISC_FEE_CHRGOFF_RVRSL_AMT AS MISC_FEE_CHRGOFF_RVRSL_AMT,
    p1.RET_CHK_FEE_CHRGOFF_RVRSL_AMT AS RET_CHK_FEE_CHRGOFF_RVRSL_AMT,
    p1.FRAUD_CHRGOFF_EVER_FLAG AS FRAUD_CHRGOFF_EVER_FLAG,
    p1.FRAUD_CHRGOFF_MNTH_FLAG AS FRAUD_CHRGOFF_MNTH_FLAG,
    p1.ANY_CHRGOFF_MNTH_FLAG AS ANY_CHRGOFF_MNTH_FLAG,
    p1.WORKOUT_PGM_FLAG AS WORKOUT_PGM_FLAG,
    p1.SEB_ACCT_FLAG AS SEB_ACCT_FLAG,
    p1.RVNUE_SRVCS_INS_AMT AS RVNUE_SRVCS_INS_AMT,
    p1.GROSS_LOSS_AMT AS GROSS_LOSS_AMT,
    p1.BT_FEE_LT_5_MOB_GROSS_AMT AS BT_FEE_LT_5_MOB_GROSS_AMT,
    p1.CASH_ADVNC_FEE_CORVSL_AMT AS CASH_ADVNC_FEE_CORVSL_AMT,
    p1.OVRLMT_FEE_CHRGOFF_RVRSL_AMT AS OVRLMT_FEE_CHRGOFF_RVRSL_AMT,
    p1.LATE_FEE_CHRGOFF_RVRSL_AMT_SL_AMT AS LATE_FEE_CHRGOFF_RVRSL_AMT_SL_AMT,
    p1.INCHG_FEE_NET_AMT AS INCHG_FEE_NET_AMT,
    p1.INCHG_FEE_GROSS_AMT AS INCHG_FEE_GROSS_AMT,
    p1.INCHG_FEE_BASE_AMT AS INCHG_FEE_BASE_AMT,
    p1.RET_CHK_FEE_NET_AMT AS RET_CHK_FEE_NET_AMT,
    p1.BT_FEE_GT_4_MOB_GROSS_AMT AS BT_FEE_GT_4_MOB_GROSS_AMT,
    p1.REWRD_PRTCP_FEE_NET_AMT AS REWRD_PRTCP_FEE_NET_AMT,
    p1.OVRLMT_FEE_MNL_RVRSL_AMT AS OVRLMT_FEE_MNL_RVRSL_AMT,
    p1.OVRLMT_FEE_GROSS_AMT AS OVRLMT_FEE_GROSS_AMT,
    p1.MISC_FEE_NET_AMT AS MISC_FEE_NET_AMT,
    p1.LATE_FEE_NET_AMT AS LATE_FEE_NET_AMT,
    p1.FCFEE_NET_AMT AS FCFEE_NET_AMT,
    p1.CLNT_PRDCT_CD AS CLNT_PRDCT_CD,
    p1.ACQUISITION_FICO AS ACQUISITION_FICO,
    p1.ACCT_OPEN_FLAG AS ACCT_OPEN_FLAG,
    p1.ACTV_WTH_BAL_FLAG AS ACTV_WTH_BAL_FLAG,
    p1.ANY_CHRGOFF_EVER_FLAG AS ANY_CHRGOFF_EVER_FLAG,
    p1.LATE_FEE_GROSS_AMT AS LATE_FEE_GROSS_AMT,
    p1.PLTFM_CD AS PLTFM_CD,
    p1.MOB_NBR AS MOB_NBR,
    p1.REVL_BAL_AMT AS REVL_BAL_AMT,
    p1.PURCH_AMT AS PURCH_AMT,
    p1.CASH_ADVNC_AMT AS CASH_ADVNC_AMT,
    p1.PAYMT_AMT AS PAYMT_AMT,
    p1.CR_LMT_AMT AS CR_LMT_AMT,
    p1.END_OF_PRD_BAL_AMT AS END_OF_PRD_BAL_AMT,
    p1.FIN_CHRG_GROSS_AMT AS FIN_CHRG_GROSS_AMT,
    p1.FIN_CHRG_MNL_RVRSL_TOT_AMT AS FIN_CHRG_MNL_RVRSL_TOT_AMT,
    p1.BAL_TXFR_TOT_AMT AS BAL_TXFR_TOT_AMT,
    p1.ANNL_FEE_GROSS_AMT AS ANNL_FEE_GROSS_AMT,
    p1.ANNL_FEE_MNL_RVRSL_AMT AS ANNL_FEE_MNL_RVRSL_AMT,
    p1.CASH_ADVNC_FEE_GROSS_AMT AS CASH_ADVNC_FEE_GROSS_AMT,
    p1.CASH_ADVNC_FEE_MNL_RVRSL_AMT AS CASH_ADVNC_FEE_MNL_RVRSL_AMT,
    p1.BAL_TXFR_FEE_GROSS_AMT AS BAL_TXFR_FEE_GROSS_AMT,
    p1.FCFEE_GROSS_AMT AS FCFEE_GROSS_AMT,
    p1.FCFEE_MNL_RVRSL_AMT AS FCFEE_MNL_RVRSL_AMT,
    p1.LATE_FEE_MNL_RVRSL_AMT AS LATE_FEE_MNL_RVRSL_AMT,
    p1.LATE_FEE_SYS_RVRSL_ANT AS LATE_FEE_SYS_RVRSL_ANT,
    p1.MISC_FEE_GROSS_AMT AS MISC_FEE_GROSS_AMT,
    p1.MISC_FEE_MNL_RVRSI_AMT AS MISC_FEE_MNL_RVRSI_AMT,
    p1.REWRD_FRTCP_FEE_GROSS_AMT AS REWRD_FRTCP_FEE_GROSS_AMT,
    p1.REWRD_PRTCP_FEE_MNL_RVRSL_AMT AS REWRD_PRTCP_FEE_MNL_RVRSL_AMT,
    p1.RET_CHK_FEE_GROSS_AMT AS RET_CHK_FEE_GROSS_AMT,
    p1.RET_CHK_FEE_MNL_RVRSL_AMT AS RET_CHK_FEE_MNL_RVRSL_AMT,
    p1.FRAUD_LOSS_AMT AS FRAUD_LOSS_AMT,
    p1.CHRGOFF_RVRSL_TOT_AMT AS CHRGOFF_RVRSL_TOT_AMT,
    p1.BANKRUPT_LOSS_AMT AS BANKRUPT_LOSS_AMT,
    p1.CHRGOFF_AMT AS CHRGOFF_AMT,
    p1.FIN_CHRG_CHRGOFF_RVRSL_TOT_AMT AS FIN_CHRG_CHRGOFF_RVRSL_TOT_AMT,
    p1.ACCT_NEW_FLAG AS ACCT_NEW_FLAG,
    p1.ACTV_STMT_FLAG AS ACTV_STMT_FLAG,
    p1.ACTV_WTH_BAL_CNT AS ACTV_WTH_BAL_CNT,
    p1.PLCY_LOSS_AMT AS PLCY_LOSS_AMT,
    p1.annl_fee_net_amt AS ANNL_FEE_NET_AMT,
    p1.DCESD_LOSS_AMT AS DCESD_LOSS_AMT,
    p1.STLMT_LOSS_AMT AS STLMT_LOSS_AMT,
    p1.SCRTZN_POOL_CD AS SCRTZN_POOL_CD,
    p1.revshr_aep_tot_amt AS revshr_aep_tot_amt,
    p1.revshr_actvtn_rewrd_amt AS revshr_actvtn_rewrd_amt,
    p1.revshr_aep_amt AS revshr_aep_amt,
    p1.revshr_actvtn_rewrd_tot_amt AS revshr_actvtn_rewrd_tot_amt,
    p1.revshr_bonus_tot_amt AS revshr_bonus_tot_amt,
    p1.revshr_bpa_sls_tot_amt AS revshr_bpa_sls_tot_amt,
    p1.revshr_excise_tax_tot_amt AS revshr_excise_tax_tot_amt,
    p1.revshr_other_tot_amt AS revshr_other_tot_amt,
    p1.revshr_purch_tot_amt AS revshr_purch_tot_amt,
    p1.revshr_rnwd_acct_tot_amt AS revshr_rnwd_acct_tot_amt,

    -- Attributes from PCDS table fmt_acct_dba.fmt_acct_c
    p2.PURCH_FRAUD_FLAG AS PURCH_FRAUD_FLAG,
    p2.CLOSED_IM_FLAG AS CLOSED_IM_FLAG,
    p2.PURCH_FRAUD_CO_AMT AS PURCH_FRAUD_CO_AMT,
    p2.PAST_DUE_151_180_AMT AS PAST_DUE_151_180_AMT,
    p2.PAST_DUE_121_150_AMT AS PAST_DUE_121_150_AMT,
    p2.PAST_DUE_31_60_AMT AS PAST_DUE_31_60_AMT,
    p2.PAST_DUE_91_120_AMT AS PAST_DUE_91_120_AMT,
    p2.PAST_DUE_61_90_AMT AS PAST_DUE_61_90_AMT,
    p2.PAST_DUE_1_30_AMT AS PAST_DUE_1_30_AMT,
    p2.CR_LMT_AMT AS CR_LMT_AMT_FMT,
    p2.CHRGOFF_AMT AS CHRGOFF_AMT_FMT,

    -- Attributes from PCDS table dmt_fin_dba.fscl_rptg_c_fact
    p3.RCVRY_ACTL_TOT_AMT AS RCVRY_ACTL_TOT_AMT,
    p3.RCVRY_ACTL_SL_AMT AS RCVRY_ACTL_SL_AMT,
    p3.RCVRY_ACTL_PAYMT_AMT AS RCVRY_ACTL_PAYMT_AMT

FROM 
    -- Join for PCDS table dmt_asp_dba.asp_emo_acct_sum
    extracted_ids ei
    LEFT JOIN dmt_asp_dba.asp_emo_acct_sum p1
        ON ei.EXTNL_ACCT_ID = p1.EXTNL_ACCT_ID

    -- Join for PCDS table fmt_acct_dba.fmt_acct_c
    LEFT JOIN fmt_acct_dba.fmt_acct_c p2
        ON ei.EXTNL_ACCT_ID = p2.EXTNL_ACCT_ID

    -- Join for PCDS table dmt_fin_dba.fscl_rptg_c_fact
    LEFT JOIN dmt_fin_dba.fscl_rptg_c_fact p3
        ON ei.EXTNL_ACCT_ID = p3.EXTNL_ACCT_ID;
