-- Consolidated SQL Query for All Attributes with LEFT JOINs
WITH extracted_ids AS (
    -- Extract 1000 IDs from the PCDS table (as per the sheet)
    SELECT DISTINCT EXTNL_ACCT_ID
    FROM dmt_asp_dba.asp_eom_acct_sum
    FETCH FIRST 1000 ROWS ONLY
)
SELECT 
    -- Selecting attributes from their respective Hive tables
    t1.EXTNL_ACCT_ID AS EXTNL_ACCT_ID_CDS_ASP_EOM_ACCT_SUM,
    t1.cd41 AS cd41,
    t1.any_chrgoff_ever_flag AS any_chrgoff_ever_flag,
    t1.cash_advnc_cnt AS cash_advnc_cnt,

    t2.abv106_rtnmtot AS abv106_rtnmtot,
    t2.cbv96_colinq AS cbv96_colinq,

    t3.cr_lmt_amt AS cr_lmt_amt,

    t4.mosinceoldesttradeopened AS mosinceoldesttradeopened,
    t4.mtgbal AS mtgbal,
    t4.revl_flag AS revl_flag,

    t5.scrtzn_pool_cd AS scrtzn_pool_cd,
    t5.sixtdelinquencycount AS sixtdelinquencycount,

    t6.totinquiriescount AS totinquiriescount,
    t6.totnumopenbankrevtradeverif6mo AS totnumopenbankrevtradeverif6mo,
    t6.totnumopenrevtradeverif6mo AS totnumopenrevtradeverif6mo,
    t6.totnumastisfactorytrade AS totnumastisfactorytrade,

    t7.tu_s004 AS tu_s004,
    t7.revutilizationamount_xj AS revutilizationamount_xj,
    t7.end_of_prd_abl_amt AS end_of_prd_abl_amt,
    t7.dlnqt_cd AS dlnqt_cd
FROM 
    extracted_ids ei
    -- Join for attributes from CDS_ASP_EOM_ACCT_SUM
    LEFT JOIN rft_ingest.cds_asp_eom_acct_sum t1
        ON ei.EXTNL_ACCT_ID = t1.EXTNL_ACCT_ID
    -- Join for attributes from APPL_ANLYS_MIX_FACT_BASE_C
    LEFT JOIN rft_ingest.appl_anlys_mix_fact_base_c t2
        ON ei.EXTNL_ACCT_ID = t2.EXTNL_ACCT_ID
    -- Join for attributes from APPL_ANLYS_MIX_FACT_BASE
    LEFT JOIN ingest.appl_anlys_mix_fact_base t3
        ON ei.EXTNL_ACCT_ID = t3.EXTNL_ACCT_ID
    -- Join for attributes from CDS_ASP_EOM_ACCT_SUM (REVL_FLAG Example)
    LEFT JOIN ingest.cds_asp_eom_acct_sum t4
        ON ei.EXTNL_ACCT_ID = t4.EXTNL_ACCT_ID
    -- Join for attributes from SKRTZN_POOL_CD
    LEFT JOIN ingest.cds_asp_eom_acct_sum t5
        ON ei.EXTNL_ACCT_ID = t5.EXTNL_ACCT_ID
    -- Join for attributes from TOTNUMOPENTRADEVERIFMO and related fields
    LEFT JOIN rft_ingest.appl_brwr_tru_c t6
        ON ei.EXTNL_ACCT_ID = t6.EXTNL_ACCT_ID
    -- Join for attributes from TOTUTILIZATIONAMOUNT_XI and related fields
    LEFT JOIN rft_ingest.appl_brwr_tru_c t7
        ON ei.EXTNL_ACCT_ID = t7.EXTNL_ACCT_ID;
