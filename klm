#!/bin/bash

# Define the previous month's last date
export LAST_DATE_PREV_MONTH=20250228

# Extract the first 6 characters (YYYYMM) for partition date
DATE_LAST_MONTH=${LAST_DATE_PREV_MONTH:0:6}

# Print the extracted date
echo "Partition Date: $DATE_LAST_MONTH"

# Run the ingestion checksum queries
INGEST_DB="your_database"  # Replace with actual database name
COLL_FINL_BK_SALE="your_table1"  # Replace with actual table name
COLL_FFS_FINL_FULL="your_table2"  # Replace with actual table name

echo "Running Ingestion Checksum for COLL_FINL_BK_SALE"
echo "SELECT (CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'Pending' END) STATUS FROM ${INGEST_DB}.${COLL_FINL_BK_SALE} WHERE PARTITION_DATE = '${DATE_LAST_MONTH}' LIMIT 10;"

echo "Running Ingestion Checksum for COLL_FFS_FINL_FULL"
echo "SELECT (CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'Pending' END) STATUS FROM ${INGEST_DB}.${COLL_FFS_FINL_FULL} WHERE PARTITION_DATE = '${LAST_DATE_PREV_MONTH}' LIMIT 10;"
