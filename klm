WITH acct_cycle AS (
    SELECT
        acct_cyc.extnl_acct_id,
        acct_cyc.annl_fee_dscr,
        ROW_NUMBER() OVER (
            PARTITION BY acct_cyc.extnl_acct_id
            ORDER BY acct_cyc.eff_dt DESC
        ) AS rn_cycle_c
    FROM SRC_STMT_DBA.ACCT_CYCL_C acct_cyc
    WHERE acct_cyc.partition_date = '20251130'
)

SELECT
    asp.extnl_acct_id,
    acct_cycle.annl_fee_dscr
FROM DMT_ASP_DBA.ASP_EOM_ACCT_SUM asp
JOIN acct_cycle
    ON asp.extnl_acct_id = acct_cycle.extnl_acct_id
   AND acct_cycle.rn_cycle_c = 1
WHERE asp.partition_date = '20251130'
  AND asp.pltfm_cd = 'C';
