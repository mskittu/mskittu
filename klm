#!/bin/bash

# List of base S3 paths and corresponding buckets
declare -A s3_buckets=(
    ["s3://uat1-prp-rftu-25-045552507264-us-east-1-cuic"]="cecl_ead_mrd_cons_fact ifrs_pre_default_mrd_fact stage_ifrs_default_book"
    ["s3://uat2-prp-rftu-25-045552507264-us-east-1-cuic"]="bucket_a bucket_b bucket_c"
    ["s3://uat3-prp-rftu-25-045552507264-us-east-1-cuic"]="bucket_x bucket_y bucket_z"
)

# Loop through each base path
for base_s3_path in "${!s3_buckets[@]}"; do
    echo "Checking buckets under: $base_s3_path"
    
    # Get the list of buckets for this base path
    buckets="${s3_buckets[$base_s3_path]}"
    
    # Loop through each bucket in the current base path
    for bucket in $buckets; do
        # Construct the full bucket path
        full_bucket_path="$base_s3_path/$bucket"
        
        # Check if the bucket exists and count files
        if aws s3 ls "$full_bucket_path" --recursive >/dev/null 2>&1; then
            file_count=$(aws s3 ls "$full_bucket_path" --recursive | wc -l)
            echo "  Bucket '$bucket' exists and contains $file_count files."
        else
            echo "  Bucket '$bucket' does not exist or cannot be accessed."
        fi
    done
    echo
done
